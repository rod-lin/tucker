module Test.Validation where

import qualified Data.ByteString as BSR

import Test.Util
import Test.HUnit
import Test.Common

-- tx0 out_idx tx1 in_idx
generalTxCase :: ScriptType -> ScriptResult -> TxPayload -> Int -> TxPayload -> Int -> IO ()    
generalTxCase stype should_be tx0 out_idx tx1 in_idx = do
    let pk_sc = decodeFailLE (pk_script (tx_out tx0 !! out_idx))
        sig_sc = decodeFailLE (sig_script (tx_in tx1 !! in_idx))
        state = initState def tx0 tx1 (fi in_idx)
        obs_stype = getScriptType [ sig_sc, pk_sc ]

    -- print ([ sig_sc, pk_sc ])

    assertBool ("wrong script type for tx " ++ show (txid tx1) ++
                " from tx " ++ show (txid tx0) ++ "(found " ++ show obs_stype ++ ")")
        (stype == obs_stype)

    assertEqual ("wrong checking result for tx " ++ show (txid tx1) ++ " from tx " ++ show (txid tx0))
        should_be (runEval state [ sig_sc, pk_sc ])

txCase1 = TestCase $ do
    -- tx0 0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9 at block #9
    -- tx1 f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16 at block #170
    let tx0 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0134ffffffff0100f2052a0100000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000"
        tx1 = hex2tx "0100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000"
     
    generalTxCase SCRIPT_P2PK ValidTx tx0 0 tx1 0

-- same as case 1, but with several extra OP_CODESEPARATORs
txCase2 = TestCase $ do
    -- tx0 0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9 at block #9
    -- tx1 f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16 at block #170
    let tx0 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0704ffff001d0134ffffffff0100f2052a0100000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000"
        tx1 = hex2tx "0100000001c997a5e56e104102fa209c6a852dd90660a20b2d9c352423edce25857fcd3704000000004847304402204e45e16932b8af514961a1d3a1a25fdf3f4f7732e9d624c6c61548ab5fb8cd410220181522ec8eca07de4860a4acdd12909d831cc56cbbac4622082221a8768d1d0901ffffffff0200ca9a3b00000000434104ae1a62fe09c5f51b13905f07f06b99a2f7159b2225f374cd378d71302fa28414e7aab37397f554a7df5f142c21c1b7303b8a0626f1baded5c72a704f7e6cd84cac00286bee0000000043410411db93e1dcdb8a016b49840f8c53bc1eb68a382e97b1482ecad7b148a6909a5cb2e0eaddfb84ccf9744464f82e160bfa9b8b64f9d4c03f999b8643f656b412a3ac00000000"
    
        out = tx_out tx0 !! 0

        op_cs = encodeLE OP_CODESEPARATOR

        tx0_edited = tx0 {
            tx_out = replace 0 (out {
                -- append/prepend op_cs's
                pk_script = op_cs <> op_cs <> pk_script out <> op_cs
            }) (tx_out tx0)
        }

    -- should have the same result
    generalTxCase SCRIPT_NONSTD ValidTx tx0_edited 0 tx1 0

txCase3 = TestCase $ do
    -- tx0 4600bf5f3d49660a546c1b9acd3e6b85479ab227115f741cf12e50506ab24b54 at block #119594
    -- tx1 e3d0425ab346dd5b76f44c222a4bb5d16640a4247050ef82462ab17e229c83b4 at block #123456
    let tx0 = hex2tx "01000000017870c6dbf8522cf9c2b3ee1c8c0e3215b1c613e6ae724405459f96bb8f3bd0ae0000000049483045022043df36465eb8854649a62b36e8d9a402bce012267ac8f4857ef3b5ca2f3396b7022100ae120cbba78942b82304c98efecbabc8745be7b8f6358f089344a2c5efe942dc01ffffffff0200127a00000000001976a914a9730a07ea5626f14f7fa304c1309602b10a055388ac00f2052a010000001976a9144d63a4b3b4ae384c44ff5d112a9b87c4c49ff36f88ac00000000"
        tx1 = hex2tx "0100000001544bb26a50502ef11c745f1127b29a47856b3ecd9a1b6c540a66493d5fbf0046010000008b483045022100c9e35aa55af5ac98cb67c4db7cf3d3f128753c4698f5d25ca0cdc3decd0c46be02204d6dfe89bd3fe88a32d47a44c0ab3ab60d87b27b90106f1b2f9f67c9c60cc80c01410449b8d933f97a8c4fe6ce962ee2abff8a81d8cfc5e0870a50cea76c50d04addf2df09331c4a47cdc3bc27a628e766ef5d01f28ee147ed21723b5ff3a62ed8da3effffffff024094ef03010000001976a9146c8de651f8b92f87ff43fb9732babec784bdb6f588acc05d1626000000001976a9144f006767feebf6438aaf51ef86ae4286a1c571b988ac00000000"

    generalTxCase SCRIPT_P2PKH ValidTx tx0 1 tx1 0

txCase4 = TestCase $ do
    -- tx0 e8b00123999ac110f94b24b440db34ef7448b9136455d04fda67b423d921f457
    -- tx1 8f36d644a4573a72bff7f6a19192159158e123ea8eb24fe2bad90bdaa3e7fb50
    let tx0 = hex2tx "0100000004c09a3e2a9742dd0b375a91eed04950cd98312637f9803d82a2d3ffc651b22684020000004a00483045022100c758a4162eb3793a1f86ddad31388bc8fdbf461b067c4b7c81da27ad7877aa6702203a100856fa7e9105e2c49210ffd3ebd488df01d78128c7ba39a8ffc1d67d7e3701ffffffffee3077463805addd75c615bd44fb6888e058128d86786922385c530316ee334e020000004a004830450221008596c6a127c11d2179e8c9f75ddc5bc3663971ac018d3767a7a3edf8a5e9d7e6022022732b1b63182ddd005e4fd3202e50855ef7398a775affbacda352135c8a438901ffffffff76b7bffc068a153f3a0caab1f13183bd9fd158eb630f78c5a509bb44f1af27813b0000006b48304502210094b439b72d5a478b6e39cb1a89964c80f84e435d3868922baf412e8a1bdce42402203427e433aa0cc727474d492c06241d2dfd1fa61866051d9c4bb245ae83c6c73c0121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d8ffffffff76b7bffc068a153f3a0caab1f13183bd9fd158eb630f78c5a509bb44f1af27813a0000006b483045022100a596a8cc061a0da5a0a66a822220591547a7071c555b939950834729fa71386702202beb7b0a916ea6262440ac5a301a966d4b6c5dd1da3602f8c3841b89fb75a2fa0121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d8ffffffff050000000000000000226a209b5e3d36ab430d2f7da585f6aca0160925e8c60456a46b5041f51aa8f9bb37163075000000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851ae3075000000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851ae3075000000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851aefd9d770000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851ae00000000"
        tx1 = hex2tx "020000001b3d5e54b179f198351dec7e960398d2d3cc404233620a3601e7ad569c2fb896c8020000004800463043021f4f31766f4d03543d0505c1fa7c47efb7b28c2dc315a0cbf9a6c2091957cbcc02206126df8f0ded9b24297d549a57c3e3df86d266c1a0251cfd999e1217784c05e701010000003d5e54b179f198351dec7e960398d2d3cc404233620a3601e7ad569c2fb896c801000000480046304302200d2a3dfcf51f92ae759e04fc693246121099ec3600fcb58acd4a59f2fef8ea07021f536e4f41f7104f68abf3ff9932a11dcd982f14ddadbc36fb9328af57066f19010100000057f421d923b467da4fd0556413b94874ef34db40b4244bf910c19a992301b0e803000000480046304302202069f8baa6b3178971898ca66a61d0f26d4cd2b4143debacb5aac4382ec3b78f021f2f634fcbf35b62fd2d569f0d900e9a5b601d760fb0735eec937ae1479c1dd1010100000057f421d923b467da4fd0556413b94874ef34db40b4244bf910c19a992301b0e8020000004800463043021f74900d446c7dd0b177c98d7da4e1ca29ddfbb1e9b8c23a908fd520264c884d02202a481f914e69c849fbe9eac8b600099a2898a49e06df7d89219edb20b8032859010100000057f421d923b467da4fd0556413b94874ef34db40b4244bf910c19a992301b0e801000000480046304302203fc322303484d03afba7c04104be920bdb09dcc7a1a801dce2803d7b2c6537e3021f557e8fd2ad46194f0f5733aaa9f72a3f66d2566e572f79d7104f7585709282010100000058f868671f6c00bc424cd0069cc26b718131b3d7f2d0082e7cebad986d8c3cc0030000004800463043022030310e5e83ba6c6456f04dd3e128528add3b3c5bd55bdb893bbe6cc613dd82b8021f7413923bd20c847622b47f250b48fa49ccef941906c6fd5bd52d2eb4b79b2b01010000006932b8601696d3aef0f5112ae735eafcc623eb829ee67e8c7dcf275215757ffc030000004800463043022017dfb6fbf00a1a2d8c43fb2bb35fa57ffd36d0449742b1aeac74577b62911095021f5422777964984ce0b3951e47108be4b00a9e89dd55cfdc51a8238e6505ba2601010000006932b8601696d3aef0f5112ae735eafcc623eb829ee67e8c7dcf275215757ffc020000004800463043022070608a5a70afc8b3306b6a274c3369fa7c4c3dac6f78f9f88cbab1b5a3355dec021f2747883735cb739ee196f2f2884d80bba1211d3d33f02c734ea35ab4fbd6cb01010000006932b8601696d3aef0f5112ae735eafcc623eb829ee67e8c7dcf275215757ffc010000004800463043021f21f1f03afd49857112aa1eedbb76994f0be3f93768c2f17c3203a1cbfbe12d022032983169dc56e51453ba5a09cfc998061dc47f44ee4dfb923840d92e67b2950c01010000000592e445406b2d3d87793f579d35d9ff8e36a1ac47a71ea8343d0caab084084a010000000504527551b201000000d4ec86d66cd005671a4e34489da9fe860ec6a85516ea655e8df4f0ef87ceffaf000000000504527551b201000000e4a9a2873568557b06a948a49f24e09a79b7b2c8366bffd1475cc8656605c03e000000000504527551b20100000089a9f04ae1292b1a363eeba1641f3130eeeecaab3b6e3cae0b3fb4e5873649d4000000000504527551b2010000001fda6f05220f240d9e435be70242e6f823ccc99ba630367157bf9dcaca6b2031000000000504527551b201000000448500f9f7132584628e8f4047c98a138b0e571ad776e1371fb8d91f276e1f4a000000000504527551b201000000551ef3b009224e0c9df9a6fa967e2a5482b6e12922a5569bbec1a006a3117c44000000000504527551b2010000004f57abc36fc0e4775619e72c09cece81f2bd4531368aeb7f69f1c0a28814c3e6000000000504527551b201000000feb7b481288de6c80df5f7681a28252e5281fa56d1d1bb147845dbb3dbb9c117000000000504527551b2010000004b50d1479b5841b20897c2d0ea0b54751a7ffa3b0aca99a57bdac766e994378c000000007f3c303902153b78ce563f89a0ed9414f5aa28ad0d96d6795f9c630220249e064ff172e42256a3f3109fa830f4501ca6742b2b53a5d2ab4a803681d13b0141043f8441c7b396fc46c6682f8abe4d3563d13635cd594025632900d16a5d44b5acc576da60cc50d99d7623c89f4e8a65d5a0e36d1f6073a0da1bc6c6c391646c2c01000000a7674cdffd68ceaf3a5002314658ccbc15eeb8d5bb712551b297920b440b2039000000004746304302205123070b141e1b7ecbf5042306bede550c4737678abe0d82b2ea3e7078102cbb021f2f7c27b5768ad60099325e2852c885f93759bffeb5a2eedfee9d7854b3df090101000000801628080c79437dbe2c8317b30629e88b409860c979db22f2601efd01db1caa0000000047463043021f604de772be9d2a69f0bb52fa528b39808c583059483d770aa7b7309c56544202201b80a34a0a2a4c37fb96e67c8d0f9fd5820ccd0212a66d8c9f3e2c4df5576e9701010000006cf8d14b561f8ca8a836d0196e5fa70fd1fe76014fd117dc14017b7379143d890300000048004630430220669d90fe159cf9007ea06d186bb12937de0bb7d82139125232a427be2480a623021f1f9deadb69e2036244cd5f5fea2c7b4f710012725a53785a5ad3f286d5322d01010000006cf8d14b561f8ca8a836d0196e5fa70fd1fe76014fd117dc14017b7379143d89020000004800463043021f6d7f99141691c6507c7e6762a120ad2b643ebdc894b11b68ffc326f6874d21022054fcfcc0ecf036a3f70bb3903b0f4718bfd55c52e5d25609d1186bcbe530560301010000006cf8d14b561f8ca8a836d0196e5fa70fd1fe76014fd117dc14017b7379143d8901000000480046304302202d322f2a36963ca5e1f550bbd2504f710cdf12b139d27891fb1916bd1ae6473e021f127af957aa6def4a81b153af179e4c8f663e9fae2b2efacd057a58947729a601010000006d4f2dcb72157c7f5125e3ebe3c5e3885637dda4e989ac19bb6ad0095b8ae3620300000048004630430220226b35583d89de81c1f2d2af2c335138f9fbf29f780d40d1740487957628b2f8021f4f8b3599ac556f2a6ac157953550568a393237d855d17a946e98578efe3eeb01010000006d4f2dcb72157c7f5125e3ebe3c5e3885637dda4e989ac19bb6ad0095b8ae362020000004800463043021f4d5e59ae2f8cc2d34114231a28cd77b12d753a56c1715bc1c88cefd9085b6a0220192c2a42318cf6f1b368262598d3cd10fcc447db55a46f5d104f55386ae761be01010000006d4f2dcb72157c7f5125e3ebe3c5e3885637dda4e989ac19bb6ad0095b8ae36201000000480046304302207fb757887ab9cb679ad6d2e269654838ecea25bb4a47a89f67e6cc5735d29c9f021f2e93f7f37d65734b89bf52479119638dd8c9514d15600a37f7b5749c8d9934010100000001b98d0b0000000000232103db3c3977c5165058bf38c46f72d32f4e872112dbafc13083a948676165cd1603ac00000000"

    generalTxCase SCRIPT_P2MULTISIG ValidTx tx0 3 tx1 2

-- edited from case 4
txCase5 = TestCase $ do
    -- tx0 e8b00123999ac110f94b24b440db34ef7448b9136455d04fda67b423d921f457
    -- tx1 8f36d644a4573a72bff7f6a19192159158e123ea8eb24fe2bad90bdaa3e7fb50 (edited)
    let tx0 = hex2tx "0100000004c09a3e2a9742dd0b375a91eed04950cd98312637f9803d82a2d3ffc651b22684020000004a00483045022100c758a4162eb3793a1f86ddad31388bc8fdbf461b067c4b7c81da27ad7877aa6702203a100856fa7e9105e2c49210ffd3ebd488df01d78128c7ba39a8ffc1d67d7e3701ffffffffee3077463805addd75c615bd44fb6888e058128d86786922385c530316ee334e020000004a004830450221008596c6a127c11d2179e8c9f75ddc5bc3663971ac018d3767a7a3edf8a5e9d7e6022022732b1b63182ddd005e4fd3202e50855ef7398a775affbacda352135c8a438901ffffffff76b7bffc068a153f3a0caab1f13183bd9fd158eb630f78c5a509bb44f1af27813b0000006b48304502210094b439b72d5a478b6e39cb1a89964c80f84e435d3868922baf412e8a1bdce42402203427e433aa0cc727474d492c06241d2dfd1fa61866051d9c4bb245ae83c6c73c0121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d8ffffffff76b7bffc068a153f3a0caab1f13183bd9fd158eb630f78c5a509bb44f1af27813a0000006b483045022100a596a8cc061a0da5a0a66a822220591547a7071c555b939950834729fa71386702202beb7b0a916ea6262440ac5a301a966d4b6c5dd1da3602f8c3841b89fb75a2fa0121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d8ffffffff050000000000000000226a209b5e3d36ab430d2f7da585f6aca0160925e8c60456a46b5041f51aa8f9bb37163075000000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851ae3075000000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851ae3075000000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851aefd9d770000000000255121022f17fb42c7a132ca9fa30825b2b0ef2964e4b56335bf89f8e088fd50dc91f9d851ae00000000"
        tx1 = hex2tx "010000001b3d5e54b179f198351dec7e960398d2d3cc404233620a3601e7ad569c2fb896c8020000004800463043021f4f31766f4d03543d0505c1fa7c47efb7b28c2dc315a0cbf9a6c2091957cbcc02206126df8f0ded9b24297d549a57c3e3df86d266c1a0251cfd999e1217784c05e701010000003d5e54b179f198351dec7e960398d2d3cc404233620a3601e7ad569c2fb896c801000000480046304302200d2a3dfcf51f92ae759e04fc693246121099ec3600fcb58acd4a59f2fef8ea07021f536e4f41f7104f68abf3ff9932a11dcd982f14ddadbc36fb9328af57066f19010100000057f421d923b467da4fd0556413b94874ef34db40b4244bf910c19a992301b0e803000000480046304302202069f8baa6b3178971898ca66a61d0f26d4cd2b4143debacb5aac4382ec3b78f021f2f634fcbf35b62fd2d569f0d900e9a5b601d760fb0735eec937ae1479c1dd1010100000057f421d923b467da4fd0556413b94874ef34db40b4244bf910c19a992301b0e8020000004800463043021f74900d446c7dd0b177c98d7da4e1ca29ddfbb1e9b8c23a908fd520264c884d02202a481f914e69c849fbe9eac8b600099a2898a49e06df7d89219edb20b8032859010100000057f421d923b467da4fd0556413b94874ef34db40b4244bf910c19a992301b0e801000000480046304302203fc322303484d03afba7c04104be920bdb09dcc7a1a801dce2803d7b2c6537e3021f557e8fd2ad46194f0f5733aaa9f72a3f66d2566e572f79d7104f7585709282010100000058f868671f6c00bc424cd0069cc26b718131b3d7f2d0082e7cebad986d8c3cc0030000004800463043022030310e5e83ba6c6456f04dd3e128528add3b3c5bd55bdb893bbe6cc613dd82b8021f7413923bd20c847622b47f250b48fa49ccef941906c6fd5bd52d2eb4b79b2b01010000006932b8601696d3aef0f5112ae735eafcc623eb829ee67e8c7dcf275215757ffc030000004800463043022017dfb6fbf00a1a2d8c43fb2bb35fa57ffd36d0449742b1aeac74577b62911095021f5422777964984ce0b3951e47108be4b00a9e89dd55cfdc51a8238e6505ba2601010000006932b8601696d3aef0f5112ae735eafcc623eb829ee67e8c7dcf275215757ffc020000004800463043022070608a5a70afc8b3306b6a274c3369fa7c4c3dac6f78f9f88cbab1b5a3355dec021f2747883735cb739ee196f2f2884d80bba1211d3d33f02c734ea35ab4fbd6cb01010000006932b8601696d3aef0f5112ae735eafcc623eb829ee67e8c7dcf275215757ffc010000004800463043021f21f1f03afd49857112aa1eedbb76994f0be3f93768c2f17c3203a1cbfbe12d022032983169dc56e51453ba5a09cfc998061dc47f44ee4dfb923840d92e67b2950c01010000000592e445406b2d3d87793f579d35d9ff8e36a1ac47a71ea8343d0caab084084a010000000504527551b201000000d4ec86d66cd005671a4e34489da9fe860ec6a85516ea655e8df4f0ef87ceffaf000000000504527551b201000000e4a9a2873568557b06a948a49f24e09a79b7b2c8366bffd1475cc8656605c03e000000000504527551b20100000089a9f04ae1292b1a363eeba1641f3130eeeecaab3b6e3cae0b3fb4e5873649d4000000000504527551b2010000001fda6f05220f240d9e435be70242e6f823ccc99ba630367157bf9dcaca6b2031000000000504527551b201000000448500f9f7132584628e8f4047c98a138b0e571ad776e1371fb8d91f276e1f4a000000000504527551b201000000551ef3b009224e0c9df9a6fa967e2a5482b6e12922a5569bbec1a006a3117c44000000000504527551b2010000004f57abc36fc0e4775619e72c09cece81f2bd4531368aeb7f69f1c0a28814c3e6000000000504527551b201000000feb7b481288de6c80df5f7681a28252e5281fa56d1d1bb147845dbb3dbb9c117000000000504527551b2010000004b50d1479b5841b20897c2d0ea0b54751a7ffa3b0aca99a57bdac766e994378c000000007f3c303902153b78ce563f89a0ed9414f5aa28ad0d96d6795f9c630220249e064ff172e42256a3f3109fa830f4501ca6742b2b53a5d2ab4a803681d13b0141043f8441c7b396fc46c6682f8abe4d3563d13635cd594025632900d16a5d44b5acc576da60cc50d99d7623c89f4e8a65d5a0e36d1f6073a0da1bc6c6c391646c2c01000000a7674cdffd68ceaf3a5002314658ccbc15eeb8d5bb712551b297920b440b2039000000004746304302205123070b141e1b7ecbf5042306bede550c4737678abe0d82b2ea3e7078102cbb021f2f7c27b5768ad60099325e2852c885f93759bffeb5a2eedfee9d7854b3df090101000000801628080c79437dbe2c8317b30629e88b409860c979db22f2601efd01db1caa0000000047463043021f604de772be9d2a69f0bb52fa528b39808c583059483d770aa7b7309c56544202201b80a34a0a2a4c37fb96e67c8d0f9fd5820ccd0212a66d8c9f3e2c4df5576e9701010000006cf8d14b561f8ca8a836d0196e5fa70fd1fe76014fd117dc14017b7379143d890300000048004630430220669d90fe159cf9007ea06d186bb12937de0bb7d82139125232a427be2480a623021f1f9deadb69e2036244cd5f5fea2c7b4f710012725a53785a5ad3f286d5322d01010000006cf8d14b561f8ca8a836d0196e5fa70fd1fe76014fd117dc14017b7379143d89020000004800463043021f6d7f99141691c6507c7e6762a120ad2b643ebdc894b11b68ffc326f6874d21022054fcfcc0ecf036a3f70bb3903b0f4718bfd55c52e5d25609d1186bcbe530560301010000006cf8d14b561f8ca8a836d0196e5fa70fd1fe76014fd117dc14017b7379143d8901000000480046304302202d322f2a36963ca5e1f550bbd2504f710cdf12b139d27891fb1916bd1ae6473e021f127af957aa6def4a81b153af179e4c8f663e9fae2b2efacd057a58947729a601010000006d4f2dcb72157c7f5125e3ebe3c5e3885637dda4e989ac19bb6ad0095b8ae3620300000048004630430220226b35583d89de81c1f2d2af2c335138f9fbf29f780d40d1740487957628b2f8021f4f8b3599ac556f2a6ac157953550568a393237d855d17a946e98578efe3eeb01010000006d4f2dcb72157c7f5125e3ebe3c5e3885637dda4e989ac19bb6ad0095b8ae362020000004800463043021f4d5e59ae2f8cc2d34114231a28cd77b12d753a56c1715bc1c88cefd9085b6a0220192c2a42318cf6f1b368262598d3cd10fcc447db55a46f5d104f55386ae761be01010000006d4f2dcb72157c7f5125e3ebe3c5e3885637dda4e989ac19bb6ad0095b8ae36201000000480046304302207fb757887ab9cb679ad6d2e269654838ecea25bb4a47a89f67e6cc5735d29c9f021f2e93f7f37d65734b89bf52479119638dd8c9514d15600a37f7b5749c8d9934010100000001b98d0b0000000000232103db3c3977c5165058bf38c46f72d32f4e872112dbafc13083a948676165cd1603ac00000000"

    generalTxCase SCRIPT_P2MULTISIG InvalidTx tx0 3 tx1 2

-- a214a2daf91691afdd491fd00d894eb3301e35bc18b5554b14e12843037e954c
-- ^ this tx contains an OP_IF!!
txCase6 = TestCase $ do
    -- tx0 a214a2daf91691afdd491fd00d894eb3301e35bc18b5554b14e12843037e954c
    -- tx1 e280770f2fdb32ca1b04949e67a211e114c0927f50846b89ab3a78b3e4c469c8
    let tx0 = hex2tx "0100000002641da415089394236ad2e22bac1b77523a426c5059defb2a793ca6ddfefbe1ba0000000049483045022100bb73c55d3ee7fcb1c29f1618ecc576ca3a0fb7d2dc182bbfdad628a08910c60802206178b02984855c997dfde25b508c7626845ddc18b001b7e1be4d40bdfc60b76901ffffffff42b93a855d7b625728626024f474915981a1527170398d7750d374911ee35123000000006a483045022100b6d488732e8d24bf2cee2036cd3d7ea763b30c9a1233b3340903b8e9eca3e8ea02207a7375ba8cccd9fc94b27ad8dea9010fadc6f02a102843069501deaa64f4783c01201b1b01dc829177da4a14551d2fc96a9db00c6501edfa12f22cd9cefd335c227fffffffff01d0933c0000000000b52102085c6600657566acc2d6382a47bc3f324008d2aa10940dd7705a48aa2a5a5e33ac7c2103f5d0fb955f95dd6be6115ce85661db412ec6a08abcbfce7da0ba8297c6cc0ec4ac7c5379a820d68df9e32a147cffa36193c6f7c43a1c8c69cda530e1c6db354bfabdcfefaf3c875379a820f531f3041d3136701ea09067c53e7159c8f9b2746a56c3d82966c54bbc553226879a5479827701200122a59a5379827701200122a59a6353798277537982778779679a6800000000"
        tx1 = hex2tx "01000000014c957e034328e1144b55b518bc351e30b34e890dd01f49ddaf9116f9daa214a2000000009300004830450221009a29101094b283ae62a6fed68603c554ca3a624b9a78d83e8065edcf97ae231b02202cbed6e796ee6f4caf30edef8f5597a08a6be265d6601ad92283990b55c038fa01473044022045d08719828fbd93e49c9223e63f4d2dab2de6c568e1faa2cccb33adf2575d2c02200c00126cb0105275040a963d91e45460147e40451b590485cf438606d3c784cf010000000001c06c3c00000000002321039dc85f5fe062d4eef0470fa96d4bbcfff0096c62042333cd05ad491536560443acda538652"
    
    generalTxCase SCRIPT_NONSTD ValidTx tx0 0 tx1 0

txCase7 = TestCase $ do
    -- tx0 40eee3ae1760e3a8532263678cdf64569e6ad06abc133af64f735e52562bccc8
    -- tx1 7edb32d4ffd7a385b763c7a8e56b6358bcd729e747290624e18acdbe6209fc45
    let tx0 = hex2tx "0100000001da75479f893cccfaa8e4558b28ec7cb4309954389f251f2212eabad7d7fda342000000006a473044022048d1468895910edafe53d4ec4209192cc3a8f0f21e7b9811f83b5e419bfb57e002203fef249b56682dbbb1528d4338969abb14583858488a3a766f609185efe68bca0121031a455dab5e1f614e574a2f4f12f22990717e93899695fb0d81e4ac2dcfd25d00ffffffff01301b0f000000000017a914e9c3dd0c07aac76179ebc76a6c78d4d67c6c160a8700000000"
        tx1 = hex2tx "0100000001c8cc2b56525e734ff63a13bc6ad06a9e5664df8c67632253a8e36017aee3ee40000000009000483045022100ad0851c69dd756b45190b5a8e97cb4ac3c2b0fa2f2aae23aed6ca97ab33bf88302200b248593abc1259512793e7dea61036c601775ebb23640a0120b0dba2c34b79001455141042f90074d7a5bf30c72cf3a8dfd1381bdbd30407010e878f3a11269d5f74a58788505cdca22ea6eab7cfb40dc0e07aba200424ab0d79122a653ad0c7ec9896bdf51aefeffffff0120f40e00000000001976a9141d30342095961d951d306845ef98ac08474b36a088aca7270400"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 0 tx1 0

-- edited from case 7
txCase8 = TestCase $ do
    -- tx0 40eee3ae1760e3a8532263678cdf64569e6ad06abc133af64f735e52562bccc8
    -- tx1 7edb32d4ffd7a385b763c7a8e56b6358bcd729e747290624e18acdbe6209fc45
    let tx0 = hex2tx "0100000001da75479f893cccfaa8e4558b28ec7cb4309954389f251f2212eabad7d7fda342000000006a473044022048d1468895910edafe53d4ec4209192cc3a8f0f21e7b9811f83b5e419bfb57e002203fef249b56682dbbb1528d4338969abb14583858488a3a766f609185efe68bca0121031a455dab5e1f614e574a2f4f12f22990717e93899695fb0d81e4ac2dcfd25d00ffffffff01301b0f000000000017a914e9c3dd0c07aac76179ebc76a6c78d4d67c6c160a8700000000"
        tx1 = hex2tx "0200000001c8cc2b56525e734ff63a13bc6ad06a9e5664df8c67632253a8e36017aee3ee40000000009000483045022100ad0851c69dd756b45190b5a8e97cb4ac3c2b0fa2f2aae23aed6ca97ab33bf88302200b248593abc1259512793e7dea61036c601775ebb23640a0120b0dba2c34b79001455141042f90074d7a5bf30c72cf3a8dfd1381bdbd30407010e878f3a11269d5f74a58788505cdca22ea6eab7cfb40dc0e07aba200424ab0d79122a653ad0c7ec9896bdf51aefeffffff0120f40e00000000001976a9141d30342095961d951d306845ef98ac08474b36a088aca7270400"

    generalTxCase (SCRIPT_P2SH undefined) InvalidTx tx0 0 tx1 0

txCase9 = TestCase $ do
    -- tx0 3edd74f3823df9befa3671a6dba5d7691a6cf0c92ac242e04a35ba9cab5e41ce
    -- tx1 5e1a524781d2118047c8593ac4d5c43b004360d0745b7cf710fe85da00044500
    let tx0 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0e0401134a4d015e062f503253482fffffffff0100f2052a01000000232103ba5005bc23e3217618c9d31e4bd1f2f46831195d453173e18de5d3e1302c5b08ac00000000"
        tx1 = hex2tx "0100000001ce415eab9cba354ae042c22ac9f06c1a69d7a5dba67136fabef93d82f374dd3e000000004948304502207735303efb716fe5ab13a4241e3d5c76556b8be53a02f3029b8628788ae4bc8a022100c672344b9fbf613c291a3e75f25f9b304b79ebe97bdaf254b8a1030e0d2a22e201ffffffff0100f2052a0100000017a914290bba32a49315789a030bb40b0047f8fb90ff668700000000"

    generalTxCase SCRIPT_P2PK ValidTx tx0 0 tx1 0

txCase10 = TestCase $ do
    -- tx0 c08053db370893765c88c93e2fe4db0aa8ebc02c70b2c91109a6081b06b5e060
    -- tx1 dc3aad51b4b9ea1ef40755a38b0b4d6e08c72d2ac5e95b8bebe9bd319b6aed7e
    let tx0 = hex2tx "01000000017ae001aef566f8273a7cd14dcbc1d2bcd7927de792c5042375033991ef5523c3000000006a47304402200bb34283458a6f141fbea8dd9c3f4db0abb8dea2282364821886e60f313be94502201198397af91be19622e8ec1e52e2e7cb5ce21640d490f1ca7fb22452e01e1fee012103e4d7f9492784fc6b3439607be821148e0d4f11ca35de74521d277500203492eaffffffff024073a574000000001976a91457722497e036129a643d767d3a9559b9dea58d0788ac809698000000000001a500000000"
        tx1 = hex2tx "010000000560e0b5061b08a60911c9b2702cc0eba80adbe42f3ec9885c76930837db5380c001000000054f01e40164ffffffff0d2fe5749c96f15e37ceed29002c7f338df4f2781dd79f4d4eea7a08aa69b959000000000351519bffffffff0d2fe5749c96f15e37ceed29002c7f338df4f2781dd79f4d4eea7a08aa69b959020000000452018293ffffffff0d2fe5749c96f15e37ceed29002c7f338df4f2781dd79f4d4eea7a08aa69b95903000000045b5a5193ffffffff0d2fe5749c96f15e37ceed29002c7f338df4f2781dd79f4d4eea7a08aa69b95904000000045b5a5193ffffffff06002d310100000000029f91002d3101000000000401908f87002d31010000000001a0002d3101000000000705feffffff808730d39700000000001976a9140467f85e06a2ef0a479333b47258f4196fb94b2c88ac002d3101000000000604ffffff7f9c00000000"

    generalTxCase SCRIPT_NONSTD ValidTx tx0 1 tx1 0

-- all combinations of SIGHASH
txCase11 = TestCase $ do
    -- NOTE: in this case tx0 is the current tx
    -- tx0 8ccc87b72d766ab3128f03176bb1c98293f2d1f85ebfaf07b82cc81ea6891fa9
    -- tx1 0030d82bb8ad9dd7664fd9e2bc14d0ae3d9cb34d2cd56d5868e5bf899ab24f2c
    -- tx2 0140c05b57e9a52808cd280bfb7e0ad00b8c38c8e022c0425e2825731815105b
    -- tx3 014ad0823a977cb5a8a54bfdc9aa27ce4967c83fd15c4f9f27025886725de1c0
    -- tx4 025c7fb450f45c9c127e876d10633e9b8faa52b8d3e5dcea82ee86da512b1b4a
    -- tx5 030f68eefffe66ba36410bc76971cf47d08b259bc2a2d997ea125130d8e0a361
    -- tx6 0326b97c2e497926e0ef2dc2359644e2e4638cf8d3fb778b8d5649513e93d6c7
    let tx0 = hex2tx "01000000062c4fb29a89bfe568586dd52c4db39c3daed014bce2d94f66d79dadb82bd83000000000004847304402202ea9d51c7173b1d96d331bd41b3d1b4e78e66148e64ed5992abd6ca66290321c0220628c47517e049b3e41509e9d71e480a0cdc766f8cdec265ef0017711c1b5336f01ffffffff5b1015187325285e42c022e0c8388c0bd00a7efb0b28cd0828a5e9575bc040010000000049483045022100bf8e050c85ffa1c313108ad8c482c4849027937916374617af3f2e9a881861c9022023f65814222cab09d5ec41032ce9c72ca96a5676020736614de7b78a4e55325a81ffffffffc0e15d72865802279f4f5cd13fc86749ce27aac9fd4ba5a8b57c973a82d04a01000000004a493046022100839c1fbc5304de944f697c9f4b1d01d1faeba32d751c0f7acb21ac8a0f436a72022100e89bd46bb3a5a62adc679f659b7ce876d83ee297c7a5587b2011c4fcc72eab4502ffffffff4a1b2b51da86ee82eadce5d3b852aa8f9b3e63106d877e129c5cf450b47f5c02000000004a493046022100eaa5f90483eb20224616775891397d47efa64c68b969db1dacb1c30acdfc50aa022100cf9903bbefb1c8000cf482b0aeeb5af19287af20bd794de11d82716f9bae3db182ffffffff61a3e0d8305112ea97d9a2c29b258bd047cf7169c70b4136ba66feffee680f030000000049483045022047d512bc85842ac463ca3b669b62666ab8672ee60725b6c06759e476cebdc6c102210083805e93bd941770109bcc797784a71db9e48913f702c56e60b1c3e2ff379a6003ffffffffc7d6933e5149568d8b77fbd3f88c63e4e2449635c22defe02679492e7cb926030000000048473044022023ee4e95151b2fbbb08a72f35babe02830d14d54bd7ed1320e4751751d1baa4802206235245254f58fd1be6ff19ca291817da76da65c2f6d81d654b5185dd86b8acf83ffffffff0700e1f505000000001976a914c311d13cfbaa1fc8d364a8e89feb1985de58ae3988ac80d1f008000000001976a914eb907923b86af59d3fd918478546c7a234586caf88ac00c2eb0b000000001976a9141c88b9d44e5fc327025157c75af73774758ba68088ac80b2e60e000000001976a914142c0947df1df159b2367a0e1328efb5b76b62bd88ac00a3e111000000001976a914616bffc03acbb416ccf76a048a9bbb974c0504c488ac8093dc14000000001976a9141d5e6e993d168384864c3a92216b9b77560d436488ac804eacab060000001976a914aa9da4a3a4ddc7398ae467eddaf80d743349d6e988ac00000000"
        tx1 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0e0424324a4d0125062f503253482fffffffff0100f2052a01000000232102715e91d37d239dea832f1460e91e368115d8ca6cc23a7da966795abad9e3b699ac00000000"
        tx2 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0e041d244a4d0165062f503253482fffffffff0100f2052a01000000232102f71546fc597e63e2a72dadeeeb50c0ca64079a5a530cb01dd939716d41e9d480ac00000000"
        tx3 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0e047d764a4d017b062f503253482fffffffff0100f2052a010000002321031ee99d2b786ab3b0991325f2de8489246a6a3fdb700f6d0511b1d80cf5f4cd43ac00000000"
        tx4 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f04480c4a4d020901062f503253482fffffffff0100f2052a0100000023210249c6a76e37c2fcd56687dde6b75bbdf72fcdeeab6fe81561a9c41ac90d9d1f48ac00000000"
        tx5 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f04b56a4a4d02c100062f503253482fffffffff0100f2052a010000002321035c100972ff8c572dc80eaa15a958ab99064d7c6b9e55f0e6408dec11edd4debbac00000000"
        tx6 = hex2tx "01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff1c3b5b93ca6d4e0fcfccdaf2c4845377e533fb4f870d430630140049edffffffff01f03b082a01000000232103837725cf7377d40a965f082fa6a942d39d9c2433c6d3c7bb4fa262e7d0d19defac00000000"

    generalTxCase SCRIPT_P2PK ValidTx tx1 0 tx0 0
    generalTxCase SCRIPT_P2PK ValidTx tx2 0 tx0 1
    generalTxCase SCRIPT_P2PK ValidTx tx3 0 tx0 2
    generalTxCase SCRIPT_P2PK ValidTx tx4 0 tx0 3
    generalTxCase SCRIPT_P2PK ValidTx tx5 0 tx0 4
    generalTxCase SCRIPT_P2PK ValidTx tx6 0 tx0 5

-- this one has a non-standard signature encoding
txCase12 = TestCase $ do
    -- tx0 af1796999f26e8e92f81adcc38bbf57b902ac4693aa0eb519ff8a39d63305b16
    -- tx1 ca05e4f0ad93be876a6abea6405c080a9c78141403753a9885c8c36ec379cf4f
    let tx0 = hex2tx "01000000015ce0318412c63146c391f8ea3cf2d33a6270bc14a3770c0fb4f26587b2586ffc010000008c493046022100ee2c5c959ec7cb9bbb3f361dfc305b4e0db3fa8af6fd6d4197fd65c1276f182f022100d9e91ddfa82c3910012e19ca0dc2c914e03f48fc6de7db9e36469a093a9f87cc0141047d47ccf8e454a20d4b78b1c69a666618246a833ba7dc344a217c5cece3ff32cc61ab96cfe9485eb9c2e377d1b12418fd450f8d6320ca2fd2a102c926a47f4187ffffffff02807c814a000000001976a914db936bee496c56c6f03bb2f391d6d593989dab2088ac80678a09020000001976a914a9df761225dc028c4578f97d0cd015f003ee5be788ac00000000"
        tx1 = hex2tx "0100000001165b30639da3f89f51eba03a69c42a907bf5bb38ccad812fe9e8269f999617af010000008c4930460221002e6f0e8b515b5f25e837592e5e8a834cbe3fabaf98973edf88b19502e0180c2d022100d03cc64f35fb277fe1b69270b542aca5620394ed7b7fae7a3546934dd6fe428801410441a8dc2e02a367c5658724fb4437c6c7317ebe72388bdb4aef74c730a81f0682bdeb337a1dae0ce8c50dadb4bd58efd3eee34f7c1820216b5798f4349d8fcbffffffffff02807c814a000000001976a9149bb8e829dbca82f4cf4f0ae3a602ab76eef8f8fd88ac00eb08bf010000001976a9145be27ad49c77a1fe275e59a02f79be1ce9aaa43088ac00000000"

    generalTxCase SCRIPT_P2PKH ValidTx tx0 1 tx1 0

-- empty pk_script
txCase13 = TestCase $ do
    -- tx0 38e6f72bc717d8a423e717f59c098b8f6f7adb2f0f85833ec02e4266bf3fad65
    -- tx1 a1f6a4ffcfd7bb4775790932aff1f82ac6a9b3b3e76c8faf8b11328e948afcca
    let tx0 = hex2tx "0100000001c323b444df62c6d1290d6be7a7db120a914c2c52ba330dcef240291e5251dc68010000006b48304502202b72aba30dd51ab93939397932ba7db51a728ab395cddfff161220f53959e03e022100cda87f332e80184c2e28eedb42b2334248e9a0ef90bb676b8504e449dcac924d012102786409cdbb55392b04e55d32d3f0c6964193b61dc537cc75f565c6535f4a9c5affffffff0101000000000000000000000000"
        tx1 = hex2tx "010000000165ad3fbf66422ec03e83850f2fdb7a6f8f8b099cf517e723a4d817c72bf7e638000000000151ffffffff0101000000000000001976a914ffca5cf550ad617598d10342b78317c2a563b77888ac00000000"

    generalTxCase SCRIPT_NONSTD ValidTx tx0 0 tx1 0

-- multisig, with the first pubkey illegal(and may cause crash) but the second correct
txCase14 = TestCase $ do
    -- tx0 2e131d48f58cbb358cc53967a2fb89a80a6da337cb430fd719f5888af7a48507
    -- tx1 bdefb2077a28d419425d8964f7d09eec89b334a258085f14ea60b71a368cd781
    let tx0 = hex2tx "010000000101c6ce2306d3d1a415cb3a4816a573384e4994cd7c9a6da906d86a91f9522e1d000000006b483045022100b5ab50db8119ccde0a6fc51837394358869f36bf8d00030f5d3b0153fd1b1cac02201e9bc491960157faf570e85722106e030631df4df2ef510bfa2c09b8e266b21f01210243203d811524ef8f3588e28b4f68b354322d317dca8c77da8a1c11d41a167a31ffffffff0140787d0100000000475121033d091990498104e71aa940771aa2b9946850591e6f4e3eac31d24078cdb20a4121000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f2052ae00000000"
        tx1 = hex2tx "01000000010785a4f78a88f519d70f43cb37a36d0aa889fba26739c58c35bb8cf5481d132e000000004a004830450221009e3787c6d9d6c072093389ecf643975a122e7334b48880fa8c5e5be2473234dd0220041f3f0338f9db2ccde267ef25e7bad7b1e67bca84a837b419f3b501823e0a3b01ffffffff0120bcbe00000000001976a91417e0a7b539f7479ba80c8f40892ee514f723824388ac00000000"

    generalTxCase SCRIPT_P2MULTISIG ValidTx tx0 0 tx1 0

-- non-canonical DER encoding(negative r in signature)
txCase15 = TestCase $ do
    -- tx0 8a5176ac6aba28190c12b4a6c5ef7c3c7cd3eece23ae0ac5adbb91b574b4c063
    -- tx1 e0e4dfd15fcde8eef256633ad60d18c742f08a689f9874ece9c4524d61351eb3
    let tx0 = hex2tx "010000000148aa0bc4e469daf2c497c5e23367b5c4537bcb6984dcc38ce5f4c569da9a37ee010000006c493046022100e0f7b0ea2cb39e4ad66d84a8583759b69a5f70ba16485042789c6d713982ccc2022100be81f8ff1be0d1283b6e21994ed9162fcee80d6567b28c1ceb833c5fe1ac6ca201210324623725c0f934d00d8f25e4b98ff58ce015d99a2811ae5651c5eb8d8f0aa777ffffffff02a02115e3070000001976a9143fd98c7924c29d34a947c34f18011a3a38d44aec88ac006d7c4d000000001976a914558047d433314f1719bfdd8ecf5e34abbd3413f088ac00000000"
        tx1 = hex2tx "010000000163c0b474b591bbadc50aae23ceeed37c3c7cefc5a6b4120c1928ba6aac76518a010000008a4730440220ce789488d7c6bec7c7cc3f8f285222040f12af61fa7ab97e6db6bda90ae93ef8022028cf6ec80e84bd164ce2f07853061c14b66ecc352255b21e8c9770e1050b9a05014104c496127b441209b4eba7dd90aac56de7c89530a3cef8f4caa0a730491e7a67be28a67e0ff34fa3adf4053189ed65f0a16b2c8489b38097017d302777cc720bccffffffff0200e1f505000000001976a9146953ce65058e5e68125a9163d74b277d6a7f4a9e88ac008c8647000000001976a91426303293f5abafc137779d4191815f10154f2f0888ac00000000"

    generalTxCase SCRIPT_P2PKH ValidTx tx0 1 tx1 0

-- unordered signature in multisig
txCase16 = TestCase $ do
    -- tx0 1a5a52921425354b4967fa45ccec300ce92ad3bdbc15a9df0f1cf16564b3ad6c
    -- tx1 598d25cce10a990a89eb003750a8ba98d6a5ccce3b1e0542dab86264902fa265
    let tx0 = hex2tx "01000000015bf7663270cf8d62a8c8c41edc5d97366e51ba3d51729a413d08fab3a55009cd010000006b483045022007caac956219178e0f1a77e8c2b708a4ed0979f1c3394ecea651163a9c66450f022100e3041b3d2025c4f014f9c1ce087c310cb2a2346623d05c01f924d2a9530b534601210215739b771960f0e217321b1b1591d00c8c3d25c7d00c1f17ad30a8ba42b40eaeffffffff02f0ea7900000000001976a914bd7b5cbd88de668e1c0b94dddd5aa264e8e7a78288ac40420f000000000017a914bb5790d0606f3d6ecd9cc345870f45a6ff1353648700000000"
        tx1 = hex2tx "01000000016cadb36465f11c0fdfa915bcbdd32ae90c30eccc45fa67494b35251492525a1a01000000fdfe00004830450220269d091056bdb9912fd8b6a1361cd224246b71d6beb09e5abe282b0b81fe309a0221008d4bca29d7199f9b9646e24b1ca8e20d586d3a8fa3b5dbda79db574d9b8c59e90148304502201402dc05b5334713aa1a61be1a62e35b3ad2104109496cb8b0e6135908c075ee022100901cef44702c5cc87bd49460d82da48e34c5a8404baf297abdb47b3bbbcf7856014c69522103afd996b9eea89c3077442e6ba79b735735aa7dbda8431b5d49bdf165652ac4322103f5998c4b219a4dc6a8a54e91bfdfe843c9f17dcb14224dbd4a3d91bdbad457ce2103afd996b9eea89c3077442e6ba79b735735aa7dbda8431b5d49bdf165652ac43253aeffffffff01a0bb0d00000000001976a914ed9653de9b381ee151b1293a67b040aeef175dd988ac00000000"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 1 tx1 0

-- a bug in encoding of OP_PUSHDATA
txCase17 = TestCase $ do
    -- tx0 b8e652f91d2fbae7292bd35f5b0e6bf6957a4cbac706ba499ab4f68211a0ce46
    -- tx1 255942b1a9217ce91ce5ff865913e44a65ed6252470b84c0a817c12c84121e1c
    let tx0 = hex2tx "0100000001514903bc677b87ce2eecbdfa1a4dc5eba82a8f775637d422bed6ab411ba2a519010000006b48304502201921fc2092e993fdcc0fc69b5e24479380dd9eafd1a4dc67cc5009a3e1dab3f0022100a38eda0e145171f6a5375f8ba213965b224201967bdff37ef2ab66a03ffee70c0121033eb88c433155c81100eb5d112ed8ef68d622ef0d21255625c5d3f2d0ba0bd5e6ffffffff02f0f91a05000000001976a914958bf803f3c99fea34c839ea508a88c4ba4030e588acfcfadb040000000017a914bcce3f7e690e5f3bbd1ed6db54dc7317659fa87c8700000000"
        tx1 = hex2tx "010000000146cea01182f6b49a49ba06c7ba4c7a95f66b0e5b5fd32b29e7ba2f1df952e6b801000000dd00493046022100a6ad0304388a4df35b444cb96ffee0b393700a6a8612f1e35cc3dc131314f893022100bcc8b2849b04dee59dcedc4fb21a96dda3fd067a381522f37a2b6813c4e1581d014830450220371b8ee29370e0d23f547163e3c238a40fe279e8edb2b838811cfca7bf5778e0022100f7e81c88ff7ea1c8da2666cae90c6a3c73a6817070c657068c678254fdb0b3f50148520021039039f617d4bd3751bc0550d38e138e7ddd2042f2b137050c872e1be8df4d6aae2103a2b5af230018a36044a0638916829ed8cf6bf745a608fe6dd22ea266a7408e7e53aeffffffff02e07cd504000000001976a914ed99b585a4c7b1578a08c599bf7e87351fe3e78e88ac0c5706000000000017a914bcce3f7e690e5f3bbd1ed6db54dc7317659fa87c8700000000"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 1 tx1 0

-- edge case on multisig with 0 public keys
txCase18 = TestCase $ do
    -- tx0 7155ef87b3b794f5315770499945ddd535c873b9a2135a0eb1661b8904b66b25
    -- tx1 b2d93dfd0b2c1a380e55e76a8d9cb3075dec9f4474e9485be008c337fd62c1f7
    let tx0 = hex2tx "01000000015ade1ceba92c38c54a34d1de2297f6c270416c95658a09a2bb396a653293fbed010000006b48304502210085895013b0df99548c07b1368064416b60b8a3f3aea4f88568580c4aa2ab441002205d4302ea1e05bb42262127715f9c0af82658115c4857300b148f5d47890073220121026bad67769ebe4ee83746f5fc8d59db6d1df01f8af698c05565c1e018d3c7e868ffffffff02c37d390d000000001976a914b9f3d073ee47210311240c38e538995776d7486688acd8d600000000000017a9142c6b107fdf106f226f3fa327ba36d6e3cac73df08700000000"
        tx1 = hex2tx "01000000037053b058b4ec949cad1e38744a56cac49753203ebbffc18dde42db9d593f6a8701000000fda7010047304402206c0ea5f7c13f4e674039855d5d46fe649c7bf4cdf6a4994c8fe47aa72e72d1b502206a475d3f3de942e9b658f873ec5dd4b8c4e07e79a63608806eb9a6fe8d4787c401483045022100a6ab9538596c0681d83f49783e4e6680fbc4418078754a898336881c7efabf7e02200d2aaf8cd1f7c44b27ed4d55503040b3ed164f0ba9ed7341816205ef2750126f01493046022100b05698172f9416ec1ad82fbefac3782057180b2cf9a1a7aaba101638b864e681022100e04023ff8e444560d243cd80b31d0e5dbbe57ae8abf1d7e39c36749b8338e0ec014cc95341048cb77cc89f647cc2cf38f912c83907c0f1e68390893cf7552ad69664b7ad492385ef0fa398a1c250f6e1bb8528b3dea42f129d913f7c599804304f8e8a4758b341049e5f8b7ccabb092f19c319f2d58c45ae7506aaa16caf93f8db61cc0668c398b10e45a17a69b7cf768593bbf34efc0a38e111a6b7bd62bbb9c9d122932be23c054104f44c2aaadd35e31e0602199167f850def15520b134458e2740155ebe20f120780a93c81799ff37e42d394a5a099bc353035a7fb6ebcd6787e4332dcbce0282dc53aeffffffff9c979646d5bec4fbdaa3ec6f062695cd45d2ecc375d503de7af8f7b71050b94701000000fda80100473044022019644ac316b10ba8188c971528398cbb78dffc0a33b67bad80675cd6e87e7fff022060d9f638ccba90aff5d304cce6ca738169e41d82cba9b4ce6f285201905c22ec01493046022100b7c747ed099ae32b7eeed21d9bf9ee218c7dde7b898150252ae45a98def09a560221009f0b14145a0f7ff689f9e5022daad6a93d31de9ae783e32d386a5e7dfe8b214401493046022100c26b1acca81c2c5f66c9000158eb3bf915913cb64b439859a19236fbd1304903022100d6054455c521e4135d9bd313029acfb3d268d5af1d34a38c8d8eada6d388c3b0014cc95341048cb77cc89f647cc2cf38f912c83907c0f1e68390893cf7552ad69664b7ad492385ef0fa398a1c250f6e1bb8528b3dea42f129d913f7c599804304f8e8a4758b341049e5f8b7ccabb092f19c319f2d58c45ae7506aaa16caf93f8db61cc0668c398b10e45a17a69b7cf768593bbf34efc0a38e111a6b7bd62bbb9c9d122932be23c054104f44c2aaadd35e31e0602199167f850def15520b134458e2740155ebe20f120780a93c81799ff37e42d394a5a099bc353035a7fb6ebcd6787e4332dcbce0282dc53aeffffffff256bb604891b66b10e5a13a2b973c835d5dd459949705731f594b7b387ef5571010000002700250021024ab33c3a547a37293eb875b4bbdbd473e9d4bafdf35687e79744dcd70f6e4de251aeffffffff030000000000000000236a210243cbdc2461a710c94ebcab8b8f1e530aeb4ff5d37270c1c8f0e369c324dd333950c30000000000001976a9144b9f31c3e99ee46479bad7aca9eac050252c0c3f88ac905f0100000000001976a9145dbe6e945b8678d3adb02905f4cb937cf5e89b8e88ac00000000"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 1 tx1 2

-- duplicated public keys in multisig
-- order test
txCase19 = TestCase $ do
    -- tx0 34e0134a924c77444a25ccd273ea0dd1d57829b0978d96c17d54144371936efa
    -- tx1 194afeeae759e0af982dc2e9b153f9bfb112c6eaf22af184307b1b22c4e64f57
    let tx0 = hex2tx "010000000132868d315b56eae8fc9175ee9b8faae2dbe8230909eaaeb7882c9840820db98c010000006b483045022100e3704294402a2e8d67c4fe9099c0efd9d07d5afdacb06170724c5ca5cb96931e02201d6ad1852baf6b51af815368fecd0307829b731754b3d1a6f2b735bd63e1d2b9012102b0041c89d03710ffc685b68c82aedfeb24edd9bfed55a74e4112084a5075a21bffffffff0300e1f5050000000017a914a6c2badadcf2eb342b9e63c0ac5267a8b2aa4e838780f0fa020000000017a9144dbcd1bb352e8d27d562ff4ea1fdb03dad6deb2987403decb7010000001976a9145fe77aa6ce0913f1c9facdc62b70412c0f50154588ac00000000"
        tx1 = hex2tx "0100000001fa6e93714314547dc1968d97b02978d5d10dea73d2cc254a44774c924a13e03401000000fd470100473044022034a6613804291dc5dae8aa4caf9ac4f266aa3f0634469f6a7bb3d62c2151261e02203151a060b95bd6e8896fd5fe4e155d8ee4b54ddea4fbb67033d45ffd548261c901493046022100bf6302cc7e871c2377e6802fe5a13d8018bc63a4eafa90da648d7dbb6db6e4b1022100a5583b9695b9f241ea457d0fc832b50d2c13e0fdb2dc30a7d35d0d9dc5a5902c0148304502200728fd420d8cffe58bb967036a8e55c87473575b14f170d862a73f3f41684ea2022100adfeea7b971963638defee9588f7fa02edbf89abb821a2c90350bb028b97f001014c69532103af88375d5fc9230446365b7d33540a73397ab3cc1a9f3e306a26833d1bfc260f21030677e0dd58025a5404747fbc64083040083acf3b390515f71a8ede95dc9c4d8a2103af88375d5fc9230446365b7d33540a73397ab3cc1a9f3e306a26833d1bfc260f53aeffffffff0170c9fa02000000001976a91430762a648dae2f279e7edb881883fa41502c249888ac00000000"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 1 tx1 0

-- 48 3045022015BD0139BCCCF990A6AF6EC5C1C52ED8222E03A0D51C334DF139968525D2FCD20221009F9EFE325476EB64C3958E4713E9EEFE49BF1D820ED58D2112721B134E2A1A5303
-- 75 52 21 0378D430274F8C5EC1321338151E9F27F4C676A008BDF8638D07C0B6BE9AB35C71
--       21 0378D430274F8C5EC1321338151E9F27F4C676A008BDF8638D07C0B6BE9AB35C71 52 AE

-- the signature in the pkscript is also removed!!! (along with the OP_PUSHDATA)
txCase20 = TestCase $ do
    -- tx0 19aa42fee0fa57c45d3b16488198b27caaacc4ff5794510d0c17f173f05587ff
    -- tx1 2c63aa814701cef5dbd4bbaddab3fea9117028f2434dddcdab8339141e9b14d1
    let tx0 = hex2tx "01000000017a2133643a513a004ff4d09bbcc7a05d7ee7d3a1d28889f0c06d06f9db1d1d8000000000fd4d0200473044022011cb94542051b8be5563b39da022d7531673ed4b53b6b3f8536794150f7d75e802205a6774c0630964457c2d4a087e5a23167155f661082746dc711ba348ca4d4187014d01025121033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b21033d1d799df4bbb828cb8fd9146407ec974948609031e50224b491a6291b77d76b5faeffffffff01a08601000000000091483045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a53037552210378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c71210378d430274f8c5ec1321338151e9f27f4c676a008bdf8638d07c0b6be9ab35c7152ae00000000"
        tx1 = hex2tx "01000000022f196cf1e5bd426a04f07b882c893b5b5edebad67da6eb50f066c372ed736d5f000000006a47304402201f81ac31b52cb4b1ceb83f97d18476f7339b74f4eecd1a32c251d4c3cccfffa402203c9143c18810ce072969e4132fdab91408816c96b423b2be38eec8a3582ade36012102aa5a2b334bd8f135f11bc5c477bf6307ff98ed52d3ed10f857d5c89adf5b02beffffffffff8755f073f1170c0d519457ffc4acaa7cb2988148163b5dc457fae0fe42aa19000000009200483045022015bd0139bcccf990a6af6ec5c1c52ed8222e03a0d51c334df139968525d2fcd20221009f9efe325476eb64c3958e4713e9eefe49bf1d820ed58d2112721b134e2a1a530347304402206da827fb26e569eb740641f9c1a7121ee59141703cbe0f903a22cc7d9a7ec7ac02204729f989b5348b3669ab020b8c4af01acc4deaba7c0d9f8fa9e06b2106cbbfeb01ffffffff010000000000000000016a00000000"

    generalTxCase SCRIPT_NONSTD ValidTx tx0 0 tx1 1

-- multiple else branches
txCase21 = TestCase $ do
    -- tx0 9f5d4b6511c511741587343403b1085b95d4b58593385e97e7c87a37a29ebe1c
    -- tx1 c2b8a39998b824b07225aff893c50a49921a4f21bfc1d977eaa42afa6ba31132
    let tx0 = hex2tx "010000000109537c7f10c0faa6fa0c9e9108819cc5e907ecf633ed31cafe7f89d9e1028767000000006b483045022100fe4d9e39b5b71e8c8e3ba310b49019dd10b5d4fa91890b804834eddcd877866c02202e4d986516a5d7a96329146ac6725d28c868630eaeca309c81f34be08d7364f4012102210ba76412d0260fb6c753eb0b48056e7f415343e8a39175956dd69895a08b04ffffffff02e09304000000000017a91436d4387548818c6db0d52e6f83b69412ad5f1c4487cfa27201000000001976a9147c20c8b419a8cb49332c8cf44ebc23d0692f42b088ac00000000"
        tx1 = hex2tx "01000000011cbe9ea2377ac8e7975e389385b5d4955b08b103343487157411c511654b5d9f00000000ea483045022100d9073d0bb21de471a26cdad0b7027e1866a2d55e4d6ed33c9827be0a26a01ad40220742c45e6fae57ff26477d4b124cc42ea59c68dc3f3523a388cab8ece5e15cff6012103456df86e6d20dda8606562ffa7361a7d5434850bac66bf597720622810d335b2004c7c76a9145cb1c75c0764b6d6b5aef2a5d9dd0a27531d662487632103a5fa9d4d893439c5af8682b9c148927160f285f990b50bac34f64fb94decbde5ac67a91479bb203cfdc27e317528340a12380efbbf156e1c87632103ba61f817e24a076f515c8d2484eea4f32550186273b5fbea57ac7a64ba5257e2ac68676a68ffffffff01d06c0400000000001976a91490e343c0e6e18b1bb3c5fd98a2187808ede2893988ac00000000"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 0 tx1 0

-- 12fc168f7b1703aa3c26e72f24bc52a54bdb22b5c72505855cc193c193364fc2
-- txCase22(very many inputs)

-- not the simplest encoding of OP_PUSHDATA
txCase22 = TestCase $ do
    -- tx0 451fda3f44b1816d59c9bed812ba721e0c841bdc1aa46d23f792aa561703d746
    -- tx1 72519286beba50478369448ffd0984556007d8b0ddfcce33caa6a2b722fd9bb6
    let tx0 = hex2tx "01000000010976d38c7c8a74e0e01fe7e72cf8a3302384c35a074cc5a12a8c8e69f66e02c700000000910047304402206524f73cb7227479566f3c5caadabfdf8d249a8b22fca73da27bae7e2595db1302203ad0818783d0ecb99836894f2a032527498527a701fd430c323ccb8ece0033340147304402206524f73cb7227479566f3c5caadabfdf8d249a8b22fca73da27bae7e2595db1302203ad0818783d0ecb99836894f2a032527498527a701fd430c323ccb8ece00333401feffffff01502198000000000017a914dc23591e74f7996dab5b29e37d2d63dbe5bae36b8791010500"
        tx1 = hex2tx "010000000146d7031756aa92f7236da41adc1b840c1e72ba12d8bec9596d81b1443fda1f4500000000fc0047304402205e353a87a9b934f45b2cdeadc1c45b55f0f9e5c2f1530772a9cd2534437ea1d90220483ea62d543531875abba69e564e62147c7b4e7c02f3c06ab790a47cd44209070147304402205e353a87a9b934f45b2cdeadc1c45b55f0f9e5c2f1530772a9cd2534437ea1d90220483ea62d543531875abba69e564e62147c7b4e7c02f3c06ab790a47cd4420907014c69524c2103f779c124bfb32f6015f4854c7fa8bcbf7369687c58b558040150aa8273b822324c4104f779c124bfb32f6015f4854c7fa8bcbf7369687c58b558040150aa8273b82232244d209162c5afe7116bdd869dea7539579d85e42a6057f05048451ff0ca449352aeffffffff0130d39700000000001976a9147c6d4a7724cb62e7d8766e510550113b3770097888ac00000000"

    generalTxCase (SCRIPT_P2SH undefined) ValidTx tx0 0 tx1 0

{-

pub keys: 03F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B82232
          04F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B82232244D209162C5AFE7116BDD869DEA7539579D85E42A6057F05048451FF0CA4493

signature: 304402205E353A87A9B934F45B2CDEADC1C45B55F0F9E5C2F1530772A9CD2534437EA1D90220483EA62D543531875ABBA69E564E62147C7B4E7C02F3C06AB790A47CD4420907
           304402205E353A87A9B934F45B2CDEADC1C45B55F0F9E5C2F1530772A9CD2534437EA1D90220483EA62D543531875ABBA69E564E62147C7B4E7C02F3C06AB790A47CD4420907

hash^2: C1A2EB9555BB8CB56A88122A955AFDBA3DB943D8911C32319B25ADC0366D57F7

redeem script:
    524C2103F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B822324C4104F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B82232244D209162C5AFE7116BDD869DEA7539579D85E42A6057F05048451FF0CA449352AE

TxPayload {
    txid = 72519286beba50478369448ffd0984556007d8b0ddfcce33caa6a2b722fd9bb6,
    wtxid = 72519286beba50478369448ffd0984556007d8b0ddfcce33caa6a2b722fd9bb6,
    version = 1, flag = 0,
    
    tx_in = [
        TxInput {
            prev_out = 451fda3f44b1816d59c9bed812ba721e0c841bdc1aa46d23f792aa561703d746 0,
            sig_script = "RR\174",
            seqn = 4294967295
        }
    ], tx_out = [TxOutput {value = 9950000, pk_script = "v\169\DC4|mJw$\203b\231\216vnQ\ENQP\DC1;7p\tx\136\172"}], tx_witness = [], lock_time = 0}

TxPayload {
    txid = 72519286beba50478369448ffd0984556007d8b0ddfcce33caa6a2b722fd9bb6,
    wtxid = 72519286beba50478369448ffd0984556007d8b0ddfcce33caa6a2b722fd9bb6,
    version = 1, flag = 0,
    
    tx_in = [
        TxInput {
            prev_out = 451fda3f44b1816d59c9bed812ba721e0c841bdc1aa46d23f792aa561703d746 0,
            sig_script = 522103F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B822324104F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B82232244D209162C5AFE7116BDD869DEA7539579D85E42A6057F05048451FF0CA449352AE,
            seqn = 4294967295
        }
    ],
    
    tx_out = [
        TxOutput {
            value = 9950000,
            pk_script = 76A9147C6D4A7724CB62E7D8766E510550113B3770097888AC
        }
    ],
    
    tx_witness = [], lock_time = 0
}

"010000000146D7031756AA92F7236DA41ADC1B840C1E72BA12D8BEC9596D81B1443FDA1F450000000067522103F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B822324104F779C124BFB32F6015F4854C7FA8BCBF7369687C58B558040150AA8273B82232244D209162C5AFE7116BDD869DEA7539579D85E42A6057F05048451FF0CA449352AEFFFFFFFF0130D39700000000001976A9147C6D4A7724CB62E7D8766E510550113B3770097888AC0000000001000000"

-}

validationTests = TestList [
        TestLabel "tx case 1" txCase1,
        TestLabel "tx case 2" txCase2,
        TestLabel "tx case 3" txCase3,
        TestLabel "tx case 4" txCase4,
        TestLabel "tx case 5" txCase5,
        TestLabel "tx case 6" txCase6,
        TestLabel "tx case 7" txCase7,
        TestLabel "tx case 8" txCase8,
        TestLabel "tx case 9" txCase9,
        TestLabel "tx case 10" txCase10,
        TestLabel "tx case 11" txCase11,
        TestLabel "tx case 12" txCase12,
        TestLabel "tx case 13" txCase13,
        TestLabel "tx case 14" txCase14,
        TestLabel "tx case 15" txCase15,
        TestLabel "tx case 16" txCase16,
        TestLabel "tx case 17" txCase17,
        TestLabel "tx case 18" txCase18,
        TestLabel "tx case 19" txCase19,
        TestLabel "tx case 20" txCase20,
        TestLabel "tx case 21" txCase21,
        TestLabel "tx case 22" txCase22
    ]
